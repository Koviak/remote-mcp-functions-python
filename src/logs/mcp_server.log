2025-09-28T17:26:25 | INFO | __main__ | 
Shutdown signal received...
2025-09-28T17:26:25 | INFO | __main__ | 
Cleaning up...
2025-09-28T17:26:25 | INFO | __main__ | 
Stopping all services...
2025-09-28T17:26:25 | INFO | __main__ | Stopping Planner sync service V5...
2025-09-28T17:26:25 | INFO | planner_sync_service_v5 | 🧹 Cleaning up webhooks...
2025-09-28T17:26:26 | INFO | httpx | HTTP Request: DELETE https://graph.microsoft.com/v1.0/subscriptions/3206c9b1-facd-47b5-a3f9-7e29095edb98 "HTTP/1.1 204 No Content"
2025-09-28T17:26:26 | INFO | planner_sync_service_v5 | ✅ Cleaned up webhook: groups
2025-09-28T17:26:26 | INFO | planner_sync_service_v5 | Webhook-driven sync service stopped
2025-09-28T17:26:26 | INFO | __main__ | Planner sync service V5 stopped.
2025-09-28T17:26:26 | INFO | __main__ | Stopping ngrok...
2025-09-28T17:26:26 | INFO | __main__ | ngrok stopped.
2025-09-28T17:26:26 | INFO | __main__ | Stopping Azure Function App...
2025-09-28T17:26:28 | INFO | __main__ | Function App stopped.
2025-09-28T17:26:30 | INFO | __main__ | All services stopped.
2025-09-28T17:26:31 | INFO | __main__ | 
Goodbye!
2025-09-28T17:26:50 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:26:55 | INFO | __main__ | Planner sync service V5 started
2025-09-28T17:26:55 | INFO | __main__ | All services started successfully
2025-09-28T17:26:55 | INFO | __main__ | Function App: http://0.0.0.0:7071
2025-09-28T17:26:55 | INFO | __main__ | Webhook URL: https://agency-swarm.ngrok.app/api/graph_webhook
2025-09-28T17:26:55 | INFO | __main__ | Planner sync service: Running
2025-09-28T17:26:55 | INFO | __main__ | Webhooks: Configured
2025-09-28T17:26:55 | INFO | __main__ | 
==================================================
2025-09-28T17:26:55 | INFO | __main__ | All services are running.
2025-09-28T17:26:55 | INFO | __main__ | Press Ctrl+C to stop all services
2025-09-28T17:26:55 | INFO | __main__ | ==================================================

2025-09-28T17:26:55 | INFO | planner_sync_service_v5 | 🚀 Starting Webhook-Driven Planner Sync Service V5...
2025-09-28T17:26:55 | INFO | annika_task_adapter | Initialized with 1 user mappings
2025-09-28T17:26:55 | INFO | planner_sync_service_v5 | Loading existing state...
2025-09-28T17:26:55 | INFO | planner_sync_service_v5 | Loaded 0 ID mappings and 0 ETags
2025-09-28T17:26:55 | INFO | planner_sync_service_v5 | 🔗 Setting up Microsoft Graph webhooks...
2025-09-28T17:26:55 | INFO | dual_auth_manager | Dual auth config - Tenant: cb629dfe...
2025-09-28T17:26:55 | INFO | dual_auth_manager | Dual auth config - Client: fd79a94d...
2025-09-28T17:26:55 | INFO | dual_auth_manager | Dual auth config - Secret: ***
2025-09-28T17:26:55 | INFO | dual_auth_manager | ✅ Dual auth configuration validated
2025-09-28T17:26:55 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/v2.0/.well-known/openid-configuration'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
No body was attached to the request
2025-09-28T17:26:55 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'max-age=86400, private'
    'Content-Type': 'application/json; charset=utf-8'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'Access-Control-Allow-Origin': 'REDACTED'
    'Access-Control-Allow-Methods': 'REDACTED'
    'P3P': 'REDACTED'
    'x-ms-request-id': '2b992985-0b09-45e1-ab31-09db648d6601'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:26:55 GMT'
    'Content-Length': '1753'
2025-09-28T17:26:55 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/oauth2/v2.0/token'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-client-sku': 'REDACTED'
    'x-client-ver': 'REDACTED'
    'x-client-os': 'REDACTED'
    'x-ms-lib-capability': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-client-current-telemetry': 'REDACTED'
    'x-client-last-telemetry': 'REDACTED'
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
A body is sent with the request
2025-09-28T17:26:56 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'no-store, no-cache'
    'Pragma': 'no-cache'
    'Content-Type': 'application/json; charset=utf-8'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'P3P': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-ms-request-id': 'fe5a06e3-6c11-43e5-a376-7e89facf9600'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-clitelem': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:26:55 GMT'
    'Content-Length': '7944'
2025-09-28T17:26:56 | INFO | azure.identity._internal.get_token_mixin | ClientSecretCredential.get_token succeeded
2025-09-28T17:26:56 | INFO | mcp_redis_config | Token stored successfully for scope: application:https://graph.microsoft.com/.default
2025-09-28T17:26:56 | INFO | planner_sync_service_v5 | Planner webhooks disabled by config; skipping /planner/tasks subscriptions
2025-09-28T17:26:56 | INFO | planner_sync_service_v5 | Planner plan-scoped webhooks disabled by config; skipping per-plan subscriptions
2025-09-28T17:26:56 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:26:57 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:26:57 | INFO | planner_sync_service_v5 | groups webhook: no existing subscription found; creating new
2025-09-28T17:26:58 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 1d9348bf-8385-47e0-82d2-d5400fd46dcf, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: c2995524-6700-49f1-9dbd-e79e4c646f4e, function type: sync, timestamp (UTC): 2025-09-28 22:26:58.340253, sync threadpool max workers: 1000
2025-09-28T17:26:58 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:26:59 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 201 Created"
2025-09-28T17:26:59 | INFO | planner_sync_service_v5 | ✅ groups webhook subscription created: 92267885-263b-43e3-aed4-7610896b16fe
2025-09-28T17:26:59 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:00 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:00 | INFO | planner_sync_service_v5 | teams_chats webhook: no existing subscription found; creating new
2025-09-28T17:27:00 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 1d9348bf-8385-47e0-82d2-d5400fd46dcf, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: ca0838d1-037b-419d-8dd4-702766024031, function type: sync, timestamp (UTC): 2025-09-28 22:27:00.468256, sync threadpool max workers: 1000
2025-09-28T17:27:00 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:27:00 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:27:01 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:01 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:01 | INFO | planner_sync_service_v5 | teams_chats webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:27:02 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:02 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:02 | INFO | planner_sync_service_v5 | teams_channels webhook: no existing subscription found; creating new
2025-09-28T17:27:03 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 1d9348bf-8385-47e0-82d2-d5400fd46dcf, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: e02fe7ea-4a9a-4c24-a376-3f87d2f64f6b, function type: sync, timestamp (UTC): 2025-09-28 22:27:03.163537, sync threadpool max workers: 1000
2025-09-28T17:27:03 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:27:03 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:27:03 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:04 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:27:04 | INFO | planner_sync_service_v5 | teams_channels webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:27:05 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions/92267885-263b-43e3-aed4-7610896b16fe "HTTP/1.1 200 OK"
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | webhook 'groups' in use: id=92267885-263b-43e3-aed4-7610896b16fe resource=/groups expires=2025-09-29T22:26:56.047148Z
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 🔄 Performing minimal initial sync...
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | Found 0 recently modified tasks to sync
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 🔍 Performing immediate Planner poll as part of initial sync...
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 🔍 Getting personal plans...
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 |    Found 1 personal plans
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 🔍 Getting group memberships...
2025-09-28T17:27:05 | WARNING | planner_sync_service_v5 | Failed to get group memberships: 400
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 📋 Total plans found: 1
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:27:05 | WARNING | planner_sync_service_v5 | Initial sync detected no task changes. Planner may be empty or the agent lacks access; forcing immediate polling loop.
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | ✅ Initial sync completed
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 📤 Monitoring Annika changes for upload...
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | 📥 Monitoring webhook notifications...
2025-09-28T17:27:05 | INFO | planner_sync_service_v5 | ⏰ Starting Planner polling loop (every 3600s)
2025-09-28T17:27:10 | INFO | planner_sync_service_v5 | 🔍 Starting hourly Planner poll for task changes...
2025-09-28T17:27:10 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:27:11 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:27:45 | INFO | __main__ | 
Shutdown signal received...
2025-09-28T17:27:45 | INFO | __main__ | 
Cleaning up...
2025-09-28T17:27:45 | INFO | __main__ | 
Stopping all services...
2025-09-28T17:27:45 | INFO | __main__ | Stopping Planner sync service V5...
2025-09-28T17:27:45 | INFO | planner_sync_service_v5 | 🧹 Cleaning up webhooks...
2025-09-28T17:27:46 | INFO | httpx | HTTP Request: DELETE https://graph.microsoft.com/v1.0/subscriptions/92267885-263b-43e3-aed4-7610896b16fe "HTTP/1.1 204 No Content"
2025-09-28T17:27:46 | INFO | planner_sync_service_v5 | ✅ Cleaned up webhook: groups
2025-09-28T17:27:46 | INFO | planner_sync_service_v5 | Webhook-driven sync service stopped
2025-09-28T17:27:46 | INFO | __main__ | Planner sync service V5 stopped.
2025-09-28T17:27:46 | INFO | __main__ | Stopping ngrok...
2025-09-28T17:27:46 | INFO | __main__ | ngrok stopped.
2025-09-28T17:27:46 | INFO | __main__ | Stopping Azure Function App...
2025-09-28T17:27:48 | INFO | __main__ | Function App stopped.
2025-09-28T17:27:50 | INFO | __main__ | All services stopped.
2025-09-28T17:27:51 | INFO | __main__ | 
Goodbye!
2025-09-28T17:28:12 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:28:18 | INFO | __main__ | Planner sync service V5 started
2025-09-28T17:28:18 | INFO | __main__ | All services started successfully
2025-09-28T17:28:18 | INFO | __main__ | Function App: http://0.0.0.0:7071
2025-09-28T17:28:18 | INFO | __main__ | Webhook URL: https://agency-swarm.ngrok.app/api/graph_webhook
2025-09-28T17:28:18 | INFO | __main__ | Planner sync service: Running
2025-09-28T17:28:18 | INFO | __main__ | Webhooks: Configured
2025-09-28T17:28:18 | INFO | __main__ | 
==================================================
2025-09-28T17:28:18 | INFO | __main__ | All services are running.
2025-09-28T17:28:18 | INFO | __main__ | Press Ctrl+C to stop all services
2025-09-28T17:28:18 | INFO | __main__ | ==================================================

2025-09-28T17:28:18 | INFO | planner_sync_service_v5 | 🚀 Starting Webhook-Driven Planner Sync Service V5...
2025-09-28T17:28:18 | INFO | annika_task_adapter | Initialized with 1 user mappings
2025-09-28T17:28:18 | INFO | planner_sync_service_v5 | Loading existing state...
2025-09-28T17:28:18 | INFO | planner_sync_service_v5 | Loaded 0 ID mappings and 0 ETags
2025-09-28T17:28:18 | INFO | planner_sync_service_v5 | 🔗 Setting up Microsoft Graph webhooks...
2025-09-28T17:28:18 | INFO | dual_auth_manager | Dual auth config - Tenant: cb629dfe...
2025-09-28T17:28:18 | INFO | dual_auth_manager | Dual auth config - Client: fd79a94d...
2025-09-28T17:28:18 | INFO | dual_auth_manager | Dual auth config - Secret: ***
2025-09-28T17:28:18 | INFO | dual_auth_manager | ✅ Dual auth configuration validated
2025-09-28T17:28:18 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/v2.0/.well-known/openid-configuration'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
No body was attached to the request
2025-09-28T17:28:18 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'max-age=86400, private'
    'Content-Type': 'application/json; charset=utf-8'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'Access-Control-Allow-Origin': 'REDACTED'
    'Access-Control-Allow-Methods': 'REDACTED'
    'P3P': 'REDACTED'
    'x-ms-request-id': '7c45f8a9-8597-4f6b-a84b-c18cc1de8701'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:28:18 GMT'
    'Content-Length': '1753'
2025-09-28T17:28:18 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/oauth2/v2.0/token'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-client-sku': 'REDACTED'
    'x-client-ver': 'REDACTED'
    'x-client-os': 'REDACTED'
    'x-ms-lib-capability': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-client-current-telemetry': 'REDACTED'
    'x-client-last-telemetry': 'REDACTED'
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
A body is sent with the request
2025-09-28T17:28:18 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'no-store, no-cache'
    'Pragma': 'no-cache'
    'Content-Type': 'application/json; charset=utf-8'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'P3P': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-ms-request-id': '07dd2218-9de4-4e2d-a915-8402ad626701'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-clitelem': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:28:18 GMT'
    'Content-Length': '7944'
2025-09-28T17:28:18 | INFO | azure.identity._internal.get_token_mixin | ClientSecretCredential.get_token succeeded
2025-09-28T17:28:18 | INFO | mcp_redis_config | Token stored successfully for scope: application:https://graph.microsoft.com/.default
2025-09-28T17:28:18 | INFO | planner_sync_service_v5 | Planner webhooks disabled by config; skipping /planner/tasks subscriptions
2025-09-28T17:28:18 | INFO | planner_sync_service_v5 | Planner plan-scoped webhooks disabled by config; skipping per-plan subscriptions
2025-09-28T17:28:19 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:19 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:19 | INFO | planner_sync_service_v5 | groups webhook: no existing subscription found; creating new
2025-09-28T17:28:20 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 075df4c9-a617-4e8f-8ecb-0b4bfe6379e7, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: 1da98998-3827-4efa-8114-ad044ca95f33, function type: sync, timestamp (UTC): 2025-09-28 22:28:20.260234, sync threadpool max workers: 1000
2025-09-28T17:28:20 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:28:20 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 201 Created"
2025-09-28T17:28:20 | INFO | planner_sync_service_v5 | ✅ groups webhook subscription created: 24a11ffb-b982-4578-9001-545353f855a3
2025-09-28T17:28:21 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:21 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:21 | INFO | planner_sync_service_v5 | teams_chats webhook: no existing subscription found; creating new
2025-09-28T17:28:22 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 075df4c9-a617-4e8f-8ecb-0b4bfe6379e7, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: cfd72b1f-0c28-416f-82cb-03e7eb84ed1a, function type: sync, timestamp (UTC): 2025-09-28 22:28:22.892558, sync threadpool max workers: 1000
2025-09-28T17:28:22 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:28:23 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:28:24 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:24 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:24 | INFO | planner_sync_service_v5 | teams_chats webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:28:24 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:25 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:25 | INFO | planner_sync_service_v5 | teams_channels webhook: no existing subscription found; creating new
2025-09-28T17:28:25 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 075df4c9-a617-4e8f-8ecb-0b4bfe6379e7, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: 47a28992-ff1d-4f19-a376-b0139afff6fa, function type: sync, timestamp (UTC): 2025-09-28 22:28:25.756259, sync threadpool max workers: 1000
2025-09-28T17:28:25 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:28:26 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:28:26 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:26 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:28:26 | INFO | planner_sync_service_v5 | teams_channels webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:28:27 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions/24a11ffb-b982-4578-9001-545353f855a3 "HTTP/1.1 200 OK"
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | webhook 'groups' in use: id=24a11ffb-b982-4578-9001-545353f855a3 resource=/groups expires=2025-09-29T22:28:18.827788Z
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 🔄 Performing minimal initial sync...
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | Found 0 recently modified tasks to sync
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 🔍 Performing immediate Planner poll as part of initial sync...
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 🔍 Getting personal plans...
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 |    Found 1 personal plans
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 🔍 Getting group memberships...
2025-09-28T17:28:27 | WARNING | planner_sync_service_v5 | Failed to get group memberships: 400
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 📋 Total plans found: 1
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:28:27 | WARNING | planner_sync_service_v5 | Initial sync detected no task changes. Planner may be empty or the agent lacks access; forcing immediate polling loop.
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | ✅ Initial sync completed
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 📤 Monitoring Annika changes for upload...
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | 📥 Monitoring webhook notifications...
2025-09-28T17:28:27 | INFO | planner_sync_service_v5 | ⏰ Starting Planner polling loop (every 3600s)
2025-09-28T17:28:32 | INFO | planner_sync_service_v5 | 🔍 Starting hourly Planner poll for task changes...
2025-09-28T17:28:32 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:28:33 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:29:27 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 075df4c9-a617-4e8f-8ecb-0b4bfe6379e7, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: aa2b1927-0dd8-45be-80f2-5d877ca4ee6b, function type: sync, timestamp (UTC): 2025-09-28 22:29:27.118224, sync threadpool max workers: 1000
2025-09-28T17:29:27 | INFO | webhook_handler | 🔔 Lifecycle event 'reauthorizationRequired' for subscription e2ee0216-cf31-482c-8ff1-e37e0e9e5970
2025-09-28T17:29:27 | ERROR | webhook_handler | Error logging webhook notification: Event loop is closed
2025-09-28T17:29:27 | INFO | endpoints.agent_webhook | Successfully processed webhook notification: None for Subscriptions/e2ee0216-cf31-482c-8ff1-e37e0e9e5970
2025-09-28T17:29:27 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:30:27 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:31:27 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:32:27 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:33:27 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:34:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:35:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:36:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:37:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:38:13 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 075df4c9-a617-4e8f-8ecb-0b4bfe6379e7, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: 69f472a4-812e-498b-9c0b-15c677916b52, function type: sync, timestamp (UTC): 2025-09-28 22:38:13.591296, sync threadpool max workers: 1000
2025-09-28T17:38:13 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:38:19 | INFO | httpx | HTTP Request: PATCH https://graph.microsoft.com/v1.0/subscriptions/e2ee0216-cf31-482c-8ff1-e37e0e9e5970 "HTTP/1.1 200 OK"
2025-09-28T17:38:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:39:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:40:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:41:28 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:42:16 | INFO | __main__ | 
Shutdown signal received...
2025-09-28T17:42:16 | INFO | __main__ | 
Cleaning up...
2025-09-28T17:42:16 | INFO | __main__ | 
Stopping all services...
2025-09-28T17:42:16 | INFO | __main__ | Stopping Planner sync service V5...
2025-09-28T17:42:16 | INFO | planner_sync_service_v5 | 🧹 Cleaning up webhooks...
2025-09-28T17:42:17 | INFO | httpx | HTTP Request: DELETE https://graph.microsoft.com/v1.0/subscriptions/24a11ffb-b982-4578-9001-545353f855a3 "HTTP/1.1 204 No Content"
2025-09-28T17:42:17 | INFO | planner_sync_service_v5 | ✅ Cleaned up webhook: groups
2025-09-28T17:42:17 | INFO | planner_sync_service_v5 | Webhook-driven sync service stopped
2025-09-28T17:42:17 | INFO | __main__ | Planner sync service V5 stopped.
2025-09-28T17:42:17 | INFO | __main__ | Stopping ngrok...
2025-09-28T17:42:17 | INFO | __main__ | ngrok stopped.
2025-09-28T17:42:17 | INFO | __main__ | Stopping Azure Function App...
2025-09-28T17:42:19 | INFO | __main__ | Function App stopped.
2025-09-28T17:42:22 | INFO | __main__ | All services stopped.
2025-09-28T17:42:22 | INFO | __main__ | 
Goodbye!
2025-09-28T17:52:32 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:52:38 | INFO | __main__ | Planner sync service V5 started
2025-09-28T17:52:38 | INFO | __main__ | All services started successfully
2025-09-28T17:52:38 | INFO | __main__ | Function App: http://0.0.0.0:7071
2025-09-28T17:52:38 | INFO | __main__ | Webhook URL: https://agency-swarm.ngrok.app/api/graph_webhook
2025-09-28T17:52:38 | INFO | __main__ | Planner sync service: Running
2025-09-28T17:52:38 | INFO | __main__ | Webhooks: Configured
2025-09-28T17:52:38 | INFO | __main__ | 
==================================================
2025-09-28T17:52:38 | INFO | __main__ | All services are running.
2025-09-28T17:52:38 | INFO | __main__ | Press Ctrl+C to stop all services
2025-09-28T17:52:38 | INFO | __main__ | ==================================================

2025-09-28T17:52:38 | INFO | planner_sync_service_v5 | 🚀 Starting Webhook-Driven Planner Sync Service V5...
2025-09-28T17:52:38 | INFO | annika_task_adapter | Initialized with 1 user mappings
2025-09-28T17:52:38 | INFO | planner_sync_service_v5 | Loading existing state...
2025-09-28T17:52:38 | INFO | planner_sync_service_v5 | Loaded 0 ID mappings and 0 ETags
2025-09-28T17:52:38 | INFO | planner_sync_service_v5 | 🔗 Setting up Microsoft Graph webhooks...
2025-09-28T17:52:38 | INFO | dual_auth_manager | Dual auth config - Tenant: cb629dfe...
2025-09-28T17:52:38 | INFO | dual_auth_manager | Dual auth config - Client: fd79a94d...
2025-09-28T17:52:38 | INFO | dual_auth_manager | Dual auth config - Secret: ***
2025-09-28T17:52:38 | INFO | dual_auth_manager | ✅ Dual auth configuration validated
2025-09-28T17:52:38 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/v2.0/.well-known/openid-configuration'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
No body was attached to the request
2025-09-28T17:52:38 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'max-age=86400, private'
    'Content-Type': 'application/json; charset=utf-8'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'Access-Control-Allow-Origin': 'REDACTED'
    'Access-Control-Allow-Methods': 'REDACTED'
    'P3P': 'REDACTED'
    'x-ms-request-id': 'e05e042b-6f4f-4c53-97d8-a67f76ec2f00'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:52:38 GMT'
    'Content-Length': '1753'
2025-09-28T17:52:38 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/oauth2/v2.0/token'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-client-sku': 'REDACTED'
    'x-client-ver': 'REDACTED'
    'x-client-os': 'REDACTED'
    'x-ms-lib-capability': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-client-current-telemetry': 'REDACTED'
    'x-client-last-telemetry': 'REDACTED'
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
A body is sent with the request
2025-09-28T17:52:38 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'no-store, no-cache'
    'Pragma': 'no-cache'
    'Content-Type': 'application/json; charset=utf-8'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'P3P': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-ms-request-id': '6e0c9321-784c-4563-8934-066c95e4fb00'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-clitelem': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:52:38 GMT'
    'Content-Length': '7944'
2025-09-28T17:52:38 | INFO | azure.identity._internal.get_token_mixin | ClientSecretCredential.get_token succeeded
2025-09-28T17:52:38 | INFO | mcp_redis_config | Token stored successfully for scope: application:https://graph.microsoft.com/.default
2025-09-28T17:52:38 | INFO | planner_sync_service_v5 | Planner webhooks disabled by config; skipping /planner/tasks subscriptions
2025-09-28T17:52:38 | INFO | planner_sync_service_v5 | Planner plan-scoped webhooks disabled by config; skipping per-plan subscriptions
2025-09-28T17:52:39 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:39 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:39 | INFO | planner_sync_service_v5 | groups webhook: no existing subscription found; creating new
2025-09-28T17:52:40 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 806a40bb-ac54-4497-889d-269aea4ceaea, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: fb291449-98ad-41b7-9ac7-22635dac4e41, function type: sync, timestamp (UTC): 2025-09-28 22:52:40.269354, sync threadpool max workers: 1000
2025-09-28T17:52:40 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:52:41 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 201 Created"
2025-09-28T17:52:41 | INFO | planner_sync_service_v5 | ✅ groups webhook subscription created: 028fa2f4-355a-4a3d-897e-affa37df817c
2025-09-28T17:52:42 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:42 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:42 | INFO | planner_sync_service_v5 | teams_chats webhook: no existing subscription found; creating new
2025-09-28T17:52:43 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 806a40bb-ac54-4497-889d-269aea4ceaea, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: 84319f41-109a-4fe4-bd89-f87ce687ee8d, function type: sync, timestamp (UTC): 2025-09-28 22:52:43.029052, sync threadpool max workers: 1000
2025-09-28T17:52:43 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:52:43 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:52:44 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:44 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:44 | INFO | planner_sync_service_v5 | teams_chats webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:52:45 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:45 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:45 | INFO | planner_sync_service_v5 | teams_channels webhook: no existing subscription found; creating new
2025-09-28T17:52:46 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 806a40bb-ac54-4497-889d-269aea4ceaea, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: 81003cc1-0301-4a08-a73a-4e5fa6ccfd24, function type: sync, timestamp (UTC): 2025-09-28 22:52:46.139570, sync threadpool max workers: 1000
2025-09-28T17:52:46 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:52:46 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:52:46 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:47 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:52:47 | INFO | planner_sync_service_v5 | teams_channels webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:52:47 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions/028fa2f4-355a-4a3d-897e-affa37df817c "HTTP/1.1 200 OK"
2025-09-28T17:52:47 | INFO | planner_sync_service_v5 | webhook 'groups' in use: id=028fa2f4-355a-4a3d-897e-affa37df817c resource=/groups expires=2025-09-29T22:52:38.733113Z
2025-09-28T17:52:47 | INFO | planner_sync_service_v5 | 🔄 Performing minimal initial sync...
2025-09-28T17:52:47 | INFO | planner_sync_service_v5 | Found 0 recently modified tasks to sync
2025-09-28T17:52:47 | INFO | planner_sync_service_v5 | 🔍 Performing immediate Planner poll as part of initial sync...
2025-09-28T17:52:47 | INFO | planner_sync_service_v5 | 🔍 Getting personal plans...
2025-09-28T17:52:48 | INFO | planner_sync_service_v5 |    Found 1 personal plans
2025-09-28T17:52:48 | INFO | planner_sync_service_v5 | 🔍 Getting group memberships...
2025-09-28T17:52:48 | WARNING | planner_sync_service_v5 | Failed to get group memberships: 400
2025-09-28T17:52:48 | INFO | planner_sync_service_v5 | 📋 Total plans found: 1
2025-09-28T17:52:48 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:52:49 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:52:49 | WARNING | planner_sync_service_v5 | Initial sync detected no task changes. Planner may be empty or the agent lacks access; forcing immediate polling loop.
2025-09-28T17:52:49 | INFO | planner_sync_service_v5 | ✅ Initial sync completed
2025-09-28T17:52:49 | INFO | planner_sync_service_v5 | 📤 Monitoring Annika changes for upload...
2025-09-28T17:52:49 | INFO | planner_sync_service_v5 | 📥 Monitoring webhook notifications...
2025-09-28T17:52:49 | INFO | planner_sync_service_v5 | ⏰ Starting Planner polling loop (every 3600s)
2025-09-28T17:52:54 | INFO | planner_sync_service_v5 | 🔍 Starting hourly Planner poll for task changes...
2025-09-28T17:52:54 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:52:54 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:53:49 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:54:49 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:55:49 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:56:49 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T17:57:24 | INFO | __main__ | 
Shutdown signal received...
2025-09-28T17:57:24 | INFO | __main__ | 
Cleaning up...
2025-09-28T17:57:24 | INFO | __main__ | 
Stopping all services...
2025-09-28T17:57:24 | INFO | __main__ | Stopping Planner sync service V5...
2025-09-28T17:57:24 | INFO | planner_sync_service_v5 | 🧹 Cleaning up webhooks...
2025-09-28T17:57:25 | INFO | httpx | HTTP Request: DELETE https://graph.microsoft.com/v1.0/subscriptions/028fa2f4-355a-4a3d-897e-affa37df817c "HTTP/1.1 204 No Content"
2025-09-28T17:57:25 | INFO | planner_sync_service_v5 | ✅ Cleaned up webhook: groups
2025-09-28T17:57:25 | INFO | planner_sync_service_v5 | Webhook-driven sync service stopped
2025-09-28T17:57:25 | INFO | __main__ | Planner sync service V5 stopped.
2025-09-28T17:57:25 | INFO | __main__ | Stopping ngrok...
2025-09-28T17:57:25 | INFO | __main__ | ngrok stopped.
2025-09-28T17:57:25 | INFO | __main__ | Stopping Azure Function App...
2025-09-28T17:57:27 | INFO | __main__ | Function App stopped.
2025-09-28T17:57:30 | INFO | __main__ | All services stopped.
2025-09-28T17:57:30 | INFO | __main__ | 
Goodbye!
2025-09-28T17:57:49 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:57:54 | INFO | __main__ | Planner sync service V5 started
2025-09-28T17:57:54 | INFO | __main__ | All services started successfully
2025-09-28T17:57:54 | INFO | __main__ | Function App: http://0.0.0.0:7071
2025-09-28T17:57:54 | INFO | __main__ | Webhook URL: https://agency-swarm.ngrok.app/api/graph_webhook
2025-09-28T17:57:54 | INFO | __main__ | Planner sync service: Running
2025-09-28T17:57:54 | INFO | __main__ | Webhooks: Configured
2025-09-28T17:57:54 | INFO | __main__ | 
==================================================
2025-09-28T17:57:54 | INFO | __main__ | All services are running.
2025-09-28T17:57:54 | INFO | __main__ | Press Ctrl+C to stop all services
2025-09-28T17:57:54 | INFO | __main__ | ==================================================

2025-09-28T17:57:54 | INFO | planner_sync_service_v5 | 🚀 Starting Webhook-Driven Planner Sync Service V5...
2025-09-28T17:57:54 | INFO | annika_task_adapter | Initialized with 1 user mappings
2025-09-28T17:57:54 | INFO | planner_sync_service_v5 | Loading existing state...
2025-09-28T17:57:54 | INFO | planner_sync_service_v5 | Loaded 0 ID mappings and 0 ETags
2025-09-28T17:57:54 | INFO | planner_sync_service_v5 | 🔗 Setting up Microsoft Graph webhooks...
2025-09-28T17:57:54 | INFO | dual_auth_manager | Dual auth config - Tenant: cb629dfe...
2025-09-28T17:57:54 | INFO | dual_auth_manager | Dual auth config - Client: fd79a94d...
2025-09-28T17:57:54 | INFO | dual_auth_manager | Dual auth config - Secret: ***
2025-09-28T17:57:54 | INFO | dual_auth_manager | ✅ Dual auth configuration validated
2025-09-28T17:57:54 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/v2.0/.well-known/openid-configuration'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
No body was attached to the request
2025-09-28T17:57:54 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'max-age=86400, private'
    'Content-Type': 'application/json; charset=utf-8'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'Access-Control-Allow-Origin': 'REDACTED'
    'Access-Control-Allow-Methods': 'REDACTED'
    'P3P': 'REDACTED'
    'x-ms-request-id': '1299b4fb-5340-4532-9bc5-1af8a3106e01'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:57:53 GMT'
    'Content-Length': '1753'
2025-09-28T17:57:54 | INFO | azure.core.pipeline.policies.http_logging_policy | Request URL: 'https://login.microsoftonline.com/cb629dfe-9f7b-497f-b0d2-502dd53d8227/oauth2/v2.0/token'
Request method: 'POST'
Request headers:
    'Accept': 'application/json'
    'x-client-sku': 'REDACTED'
    'x-client-ver': 'REDACTED'
    'x-client-os': 'REDACTED'
    'x-ms-lib-capability': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-client-current-telemetry': 'REDACTED'
    'x-client-last-telemetry': 'REDACTED'
    'User-Agent': 'azsdk-python-identity/1.25.0 Python/3.11.13 (Windows-10-10.0.26220-SP0)'
A body is sent with the request
2025-09-28T17:57:54 | INFO | azure.core.pipeline.policies.http_logging_policy | Response status: 200
Response headers:
    'Cache-Control': 'no-store, no-cache'
    'Pragma': 'no-cache'
    'Content-Type': 'application/json; charset=utf-8'
    'Expires': '-1'
    'Strict-Transport-Security': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'P3P': 'REDACTED'
    'client-request-id': 'REDACTED'
    'x-ms-request-id': '76f06f96-815b-4cae-8e81-ad2c201a3100'
    'x-ms-ests-server': 'REDACTED'
    'x-ms-clitelem': 'REDACTED'
    'x-ms-srs': 'REDACTED'
    'Content-Security-Policy-Report-Only': 'REDACTED'
    'Cross-Origin-Opener-Policy-Report-Only': 'REDACTED'
    'Reporting-Endpoints': 'REDACTED'
    'X-XSS-Protection': 'REDACTED'
    'Set-Cookie': 'REDACTED'
    'Date': 'Sun, 28 Sep 2025 22:57:54 GMT'
    'Content-Length': '7944'
2025-09-28T17:57:54 | INFO | azure.identity._internal.get_token_mixin | ClientSecretCredential.get_token succeeded
2025-09-28T17:57:54 | INFO | mcp_redis_config | Token stored successfully for scope: application:https://graph.microsoft.com/.default
2025-09-28T17:57:54 | INFO | planner_sync_service_v5 | Planner webhooks disabled by config; skipping /planner/tasks subscriptions
2025-09-28T17:57:54 | INFO | planner_sync_service_v5 | Planner plan-scoped webhooks disabled by config; skipping per-plan subscriptions
2025-09-28T17:57:55 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:57:56 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:57:56 | INFO | planner_sync_service_v5 | groups webhook: no existing subscription found; creating new
2025-09-28T17:57:56 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 0af94802-6a21-4135-bbee-8f63c61095cb, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: ea6aba39-9e5d-4236-923a-45b031ca61c1, function type: sync, timestamp (UTC): 2025-09-28 22:57:56.387160, sync threadpool max workers: 1000
2025-09-28T17:57:56 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:57:56 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 201 Created"
2025-09-28T17:57:56 | INFO | planner_sync_service_v5 | ✅ groups webhook subscription created: 07181621-d8a1-4160-908e-016364cc904d
2025-09-28T17:57:57 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:57:58 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:57:58 | INFO | planner_sync_service_v5 | teams_chats webhook: no existing subscription found; creating new
2025-09-28T17:57:58 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 0af94802-6a21-4135-bbee-8f63c61095cb, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: cb8b556b-fdc5-4723-8b96-c80b42da7c89, function type: sync, timestamp (UTC): 2025-09-28 22:57:58.749439, sync threadpool max workers: 1000
2025-09-28T17:57:58 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:57:58 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:57:59 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:57:59 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:57:59 | INFO | planner_sync_service_v5 | teams_chats webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:58:01 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:58:02 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:58:02 | INFO | planner_sync_service_v5 | teams_channels webhook: no existing subscription found; creating new
2025-09-28T17:58:02 | INFO | azure_functions_worker | Received FunctionInvocationRequest, request ID: 0af94802-6a21-4135-bbee-8f63c61095cb, function ID: a9cad05f-00be-512b-b317-e8939ff77875, function name: graph_webhook_http, invocation ID: d15673cb-f88e-4323-85a1-ea705541dfeb, function type: sync, timestamp (UTC): 2025-09-28 22:58:02.826774, sync threadpool max workers: 1000
2025-09-28T17:58:02 | INFO | endpoints.agent_webhook | Graph webhook validation request received
2025-09-28T17:58:03 | INFO | httpx | HTTP Request: POST https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 403 Forbidden"
2025-09-28T17:58:04 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:58:04 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions "HTTP/1.1 200 OK"
2025-09-28T17:58:04 | INFO | planner_sync_service_v5 | teams_channels webhook: quota reached; verifying existing subscription matches current notificationUrl before assuming active
2025-09-28T17:58:05 | INFO | httpx | HTTP Request: GET https://graph.microsoft.com/v1.0/subscriptions/07181621-d8a1-4160-908e-016364cc904d "HTTP/1.1 200 OK"
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | webhook 'groups' in use: id=07181621-d8a1-4160-908e-016364cc904d resource=/groups expires=2025-09-29T22:57:54.92767Z
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | 🔄 Performing minimal initial sync...
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | Found 0 recently modified tasks to sync
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | 🔍 Performing immediate Planner poll as part of initial sync...
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | Using application token for Planner reads
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ?? Getting tenant-wide plans (application auth)...
2025-09-28T17:58:05 | WARNING | planner_sync_service_v5 | Failed to get tenant-wide plans (page 1): 403 - {"error":{"code":"UnknownError","message":"","innerError":{"date":"2025-09-28T22:58:05","request-id":"6f82fff1-185c-485f-ab12-b356bb61e299","client-request-id":"6f82fff1-185c-485f-ab12-b356bb61e299"}}}
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 |    Found 0 plans via application auth
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ?? Total plans found: 0
2025-09-28T17:58:05 | WARNING | planner_sync_service_v5 | Application token returned no plans; retrying with delegated fallback
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ?? Getting personal plans...
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 |    Found 1 personal plans
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ?? Getting group memberships...
2025-09-28T17:58:05 | WARNING | planner_sync_service_v5 | Failed to get group memberships: 400 - {"error":{"code":"BadRequest","message":"Parsing OData Select and Expand failed: Term '@odata.type' is not valid in a $select or $expand expression.","innerError":{"date":"2025-09-28T22:58:05","request-id":"7c689475-02ca-412e-8473-7117ec9bc95f","client-req
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 |    No group memberships returned
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ?? Total plans found: 1
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:58:05 | WARNING | planner_sync_service_v5 | Initial sync detected no task changes. Planner may be empty or the agent lacks access; forcing immediate polling loop.
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ✅ Initial sync completed
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | 📤 Monitoring Annika changes for upload...
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | 📥 Monitoring webhook notifications...
2025-09-28T17:58:05 | INFO | planner_sync_service_v5 | ⏰ Starting Planner polling loop (every 3600s)
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | 🔍 Starting hourly Planner poll for task changes...
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | ?? Getting tenant-wide plans (application auth)...
2025-09-28T17:58:10 | WARNING | planner_sync_service_v5 | Failed to get tenant-wide plans (page 1): 403 - {"error":{"code":"UnknownError","message":"","innerError":{"date":"2025-09-28T22:58:10","request-id":"cb85003c-9006-4e7a-a8c8-b286e4935627","client-request-id":"cb85003c-9006-4e7a-a8c8-b286e4935627"}}}
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 |    Found 0 plans via application auth
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | ?? Total plans found: 0
2025-09-28T17:58:10 | WARNING | planner_sync_service_v5 | Application token returned no plans; retrying with delegated fallback
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | ?? Getting personal plans...
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 |    Found 1 personal plans
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | ?? Getting group memberships...
2025-09-28T17:58:10 | WARNING | planner_sync_service_v5 | Failed to get group memberships: 400 - {"error":{"code":"BadRequest","message":"Parsing OData Select and Expand failed: Term '@odata.type' is not valid in a $select or $expand expression.","innerError":{"date":"2025-09-28T22:58:11","request-id":"8a3f6287-defd-47c9-8099-e5f32e5ba9bf","client-req
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 |    No group memberships returned
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | ?? Total plans found: 1
2025-09-28T17:58:10 | INFO | planner_sync_service_v5 | 📋 Polling 1 Planner plans for task changes
2025-09-28T17:58:11 | INFO | planner_sync_service_v5 | ✅ Planner polling complete: 0 tasks checked, 0 created, 0 updated
2025-09-28T17:59:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:00:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:01:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:02:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:02:47 | INFO | token_refresh_service | Token for scope 'Bookings.Manage.All Bookings.ReadWrite.All Calendars.ReadWrite.Shared ChannelMessage.ReadWrite ChannelMessage.Send Chat.Create Chat.ManageDeletion.All ChatMember.ReadWrite ChatMessage.Read ChatMessage.Send Community.ReadWrite.All EWS.AccessAsUser.All FileStorageContainer.Selected Files.ReadWrite.All Files.ReadWrite.AppFolder Files.ReadWrite.Selected Files.SelectedOperations.Selected Goals-Export.ReadWrite.All Group.ReadWrite.All GroupMember.ReadWrite.All IMAP.AccessAsUser.All Mail-Advanced.ReadWrite.Shared Mail.ReadWrite Mail.ReadWrite.Shared Mail.Send Mail.Send.Shared MailboxFolder.ReadWrite MailboxItem.ImportExport MailboxItem.Read MailboxSettings.ReadWrite ManagedTenants.ReadWrite.All Notes.Create Notes.ReadWrite.All POP.AccessAsUser.All People.Read.All PeopleSettings.ReadWrite.All Place.ReadWrite.All PlaceDevice.ReadWrite.All SMTP.Send SecurityActions.ReadWrite.All SecurityAlert.ReadWrite.All SecurityAnalyzedMessage.ReadWrite.All SecurityEvents.ReadWrite.All Sites.FullControl.All Sites.Manage.All Sites.ReadWrite.All Sites.Selected Subscription.Read.All Tasks.ReadWrite Tasks.ReadWrite.Shared Team.Create TeamMember.ReadWrite.All TeamMember.ReadWriteNonOwnerRole.All TeamSettings.Read.All TeamSettings.ReadWrite.All TeamTemplates.Read TeamsActivity.Read TeamsActivity.Send TeamsAppInstallation.ReadWriteAndConsentForChat TeamsAppInstallation.ReadWriteAndConsentForTeam TeamsAppInstallation.ReadWriteAndConsentForUser TeamsAppInstallation.ReadWriteForChat TeamsAppInstallation.ReadWriteForTeam TeamsAppInstallation.ReadWriteForUser TeamsAppInstallation.ReadWriteSelfForChat TeamsAppInstallation.ReadWriteSelfForTeam TeamsAppInstallation.ReadWriteSelfForUser TeamsTab.Create TeamsTab.Read.All TeamsTab.ReadWrite.All TeamsTab.ReadWriteForChat TeamsTab.ReadWriteForTeam TeamsTab.ReadWriteForUser TeamsUserConfiguration.Read.All Teamwork.Read.All TeamworkAppSettings.ReadWrite.All TeamworkDevice.ReadWrite.All TeamworkTag.ReadWrite TeamworkUserInteraction.Read.All TermStore.ReadWrite.All ThreatAssessment.ReadWrite.All User.Read User.ReadBasic.All User.ReadWrite.All UserTeamwork.Read UserTimelineActivity.Write.CreatedByApp VirtualAppointment.ReadWrite VirtualAppointmentNotification.Send VirtualEvent.ReadWrite email offline_access openid profile' expiring in 344 seconds, refreshing...
2025-09-28T18:02:47 | INFO | token_refresh_service | Successfully refreshed token for scope: Bookings.Manage.All Bookings.ReadWrite.All Calendars.ReadWrite.Shared ChannelMessage.ReadWrite ChannelMessage.Send Chat.Create Chat.ManageDeletion.All ChatMember.ReadWrite ChatMessage.Read ChatMessage.Send Community.ReadWrite.All EWS.AccessAsUser.All FileStorageContainer.Selected Files.ReadWrite.All Files.ReadWrite.AppFolder Files.ReadWrite.Selected Files.SelectedOperations.Selected Goals-Export.ReadWrite.All Group.ReadWrite.All GroupMember.ReadWrite.All IMAP.AccessAsUser.All Mail-Advanced.ReadWrite.Shared Mail.ReadWrite Mail.ReadWrite.Shared Mail.Send Mail.Send.Shared MailboxFolder.ReadWrite MailboxItem.ImportExport MailboxItem.Read MailboxSettings.ReadWrite ManagedTenants.ReadWrite.All Notes.Create Notes.ReadWrite.All POP.AccessAsUser.All People.Read.All PeopleSettings.ReadWrite.All Place.ReadWrite.All PlaceDevice.ReadWrite.All SMTP.Send SecurityActions.ReadWrite.All SecurityAlert.ReadWrite.All SecurityAnalyzedMessage.ReadWrite.All SecurityEvents.ReadWrite.All Sites.FullControl.All Sites.Manage.All Sites.ReadWrite.All Sites.Selected Subscription.Read.All Tasks.ReadWrite Tasks.ReadWrite.Shared Team.Create TeamMember.ReadWrite.All TeamMember.ReadWriteNonOwnerRole.All TeamSettings.Read.All TeamSettings.ReadWrite.All TeamTemplates.Read TeamsActivity.Read TeamsActivity.Send TeamsAppInstallation.ReadWriteAndConsentForChat TeamsAppInstallation.ReadWriteAndConsentForTeam TeamsAppInstallation.ReadWriteAndConsentForUser TeamsAppInstallation.ReadWriteForChat TeamsAppInstallation.ReadWriteForTeam TeamsAppInstallation.ReadWriteForUser TeamsAppInstallation.ReadWriteSelfForChat TeamsAppInstallation.ReadWriteSelfForTeam TeamsAppInstallation.ReadWriteSelfForUser TeamsTab.Create TeamsTab.Read.All TeamsTab.ReadWrite.All TeamsTab.ReadWriteForChat TeamsTab.ReadWriteForTeam TeamsTab.ReadWriteForUser TeamsUserConfiguration.Read.All Teamwork.Read.All TeamworkAppSettings.ReadWrite.All TeamworkDevice.ReadWrite.All TeamworkTag.ReadWrite TeamworkUserInteraction.Read.All TermStore.ReadWrite.All ThreatAssessment.ReadWrite.All User.Read User.ReadBasic.All User.ReadWrite.All UserTeamwork.Read UserTimelineActivity.Write.CreatedByApp VirtualAppointment.ReadWrite VirtualAppointmentNotification.Send VirtualEvent.ReadWrite email offline_access openid profile
2025-09-28T18:03:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:04:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:05:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:06:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:07:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:07:49 | INFO | root | Successfully acquired user token via ROPC
2025-09-28T18:07:49 | INFO | mcp_redis_config | Token stored successfully for scope: Bookings.Manage.All Bookings.ReadWrite.All Calendars.ReadWrite.Shared ChannelMessage.ReadWrite ChannelMessage.Send Chat.Create Chat.ManageDeletion.All ChatMember.ReadWrite ChatMessage.Read ChatMessage.Send Community.ReadWrite.All EWS.AccessAsUser.All FileStorageContainer.Selected Files.ReadWrite.All Files.ReadWrite.AppFolder Files.ReadWrite.Selected Files.SelectedOperations.Selected Goals-Export.ReadWrite.All Group.ReadWrite.All GroupMember.ReadWrite.All IMAP.AccessAsUser.All Mail-Advanced.ReadWrite.Shared Mail.ReadWrite Mail.ReadWrite.Shared Mail.Send Mail.Send.Shared MailboxFolder.ReadWrite MailboxItem.ImportExport MailboxItem.Read MailboxSettings.ReadWrite ManagedTenants.ReadWrite.All Notes.Create Notes.ReadWrite.All POP.AccessAsUser.All People.Read.All PeopleSettings.ReadWrite.All Place.ReadWrite.All PlaceDevice.ReadWrite.All SMTP.Send SecurityActions.ReadWrite.All SecurityAlert.ReadWrite.All SecurityAnalyzedMessage.ReadWrite.All SecurityEvents.ReadWrite.All Sites.FullControl.All Sites.Manage.All Sites.ReadWrite.All Sites.Selected Subscription.Read.All Tasks.ReadWrite Tasks.ReadWrite.Shared Team.Create TeamMember.ReadWrite.All TeamMember.ReadWriteNonOwnerRole.All TeamSettings.Read.All TeamSettings.ReadWrite.All TeamTemplates.Read TeamsActivity.Read TeamsActivity.Send TeamsAppInstallation.ReadWriteAndConsentForChat TeamsAppInstallation.ReadWriteAndConsentForTeam TeamsAppInstallation.ReadWriteAndConsentForUser TeamsAppInstallation.ReadWriteForChat TeamsAppInstallation.ReadWriteForTeam TeamsAppInstallation.ReadWriteForUser TeamsAppInstallation.ReadWriteSelfForChat TeamsAppInstallation.ReadWriteSelfForTeam TeamsAppInstallation.ReadWriteSelfForUser TeamsTab.Create TeamsTab.Read.All TeamsTab.ReadWrite.All TeamsTab.ReadWriteForChat TeamsTab.ReadWriteForTeam TeamsTab.ReadWriteForUser TeamsUserConfiguration.Read.All Teamwork.Read.All TeamworkAppSettings.ReadWrite.All TeamworkDevice.ReadWrite.All TeamworkTag.ReadWrite TeamworkUserInteraction.Read.All TermStore.ReadWrite.All ThreatAssessment.ReadWrite.All User.Read User.ReadBasic.All User.ReadWrite.All UserTeamwork.Read UserTimelineActivity.Write.CreatedByApp VirtualAppointment.ReadWrite VirtualAppointmentNotification.Send VirtualEvent.ReadWrite email offline_access openid profile
2025-09-28T18:08:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:09:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:10:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:11:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:12:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:13:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:14:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:15:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:16:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:17:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:18:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
2025-09-28T18:19:05 | INFO | planner_sync_service_v5 | 📊 Health Check: processed=0 pending=0 failed=0 rate=ok webhooks=1
